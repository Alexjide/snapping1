<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 소환 및 다시 시작하기</title>
    <style>
        .movableImage {
            position: absolute;
            transition: transform 0.5s ease-in-out; /* 초기 이동 속도, 클릭 시 조정됨 */
            max-width: 500px; /* 이미지 최대 크기 설정 */
            max-height: 500px; /* 이미지 최대 크기 설정 */
        }
    </style>
</head>
<body>

<input type="file" id="imageInput" accept="image/*"><br>
<button id="summonButton">소환</button>
<button id="resetButton">다시 시작하기</button><br>
<label for="speedControl">이동 속도 (기준):</label>
<input type="range" id="speedControl" min="0.1" max="2" step="0.1" value="1"><br>
<label for="sizeControl">이미지 크기 (%):</label>
<input type="range" id="sizeControl" min="10" max="100" step="1" value="15">

<script>
    let imageSrc = null;
    let images = [];

    document.getElementById('imageInput').addEventListener('change', function(event) {
        if (event.target.files && event.target.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imageSrc = e.target.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    });

    document.getElementById('summonButton').addEventListener('click', function() {
        if (imageSrc) {
            const img = document.createElement('img');
            img.src = imageSrc;
            img.classList.add('movableImage');
            document.body.appendChild(img);
            images.push(img);
            // 초기 소환 시 이미지의 위치 및 크기 조정
            adjustImageSizeAndPosition(img);
        }
    });

    document.getElementById('resetButton').addEventListener('click', function() {
        images.forEach(img => img.remove());
        images = []; // 이미지 목록 초기화
    });

    document.addEventListener('touchstart', function(event) {
        const touch = event.touches[0];
        images.forEach(img => {
            moveImageToRandomPosition(img, touch.pageX, touch.pageY);
        });
    });

    document.getElementById('sizeControl').addEventListener('input', function() {
        images.forEach(img => {
            adjustImageSizeAndPosition(img, true); // 크기 조정만, 위치는 조정하지 않음
        });
    });

    function adjustImageSizeAndPosition(img, sizeOnly = false) {
        const sizePercentage = document.getElementById('sizeControl').value;
        img.style.width = `${sizePercentage}%`;
        if (!sizeOnly) {
            const offsetX = (Math.random() * 15 + 5) * (images.length % 2 === 0 ? -1 : 1);
            const offsetY = (Math.random() * 15 + 5) * (images.length % 2 === 0 ? -1 : 1);
            img.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
        }
    }

    document.addEventListener('click', function(event) {
        const x = event.clientX || event.touches[0].clientX;
        const y = event.clientY || event.touches[0].clientY;
    
        // 이미지가 슬라이더 또는 버튼을 클릭한 경우에는 이미지 이동하지 않음
        if (event.target.matches('#imageInput, #summonButton, #speedControl, #resetButton, #sizeControl')) return;
    
        images.forEach(img => {
            moveImageToRandomPosition(img, x, y);
        });
    });
    
    document.addEventListener('click', function(event) {
        const x = event.clientX || event.touches[0].clientX;
        const y = event.clientY || event.touches[0].clientY;
    
        // 이미지가 슬라이더 또는 버튼을 클릭한 경우에는 이미지 이동하지 않음
        if (event.target.matches('#imageInput, #summonButton, #speedControl, #resetButton, #sizeControl')) return;
    
        images.forEach(img => {
            moveImageToRandomPosition(img, x, y);
        });
    });
    
    function moveImageToRandomPosition(img, x, y) {
        const speedAdjustment = Math.random() * 0.2 - 0.1; // 속도 변화량 -0.1 ~ +0.1
        const speed = 1.5 + speedAdjustment;
        img.style.transition = `transform ${speed}s ease-in-out`;
    
        // 클릭한 위치에서 일정 범위 내의 랜덤한 값으로 이동
        const offsetX = x + (Math.random() * 100 - 20);
        const offsetY = y + (Math.random() * 100 - 20);
        
        img.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
    }
    
    document.getElementById('summonButton').addEventListener('click', function() {
        if (imageSrc) {
            const img = document.createElement('img');
            img.src = imageSrc;
            img.classList.add('movableImage');
            document.body.appendChild(img);
            images.push(img);
            adjustImageSizeAndPosition(img);
        }
    });
    
    document.getElementById('resetButton').addEventListener('click', function() {
        images.forEach(img => img.remove());
        images = [];
    });
    
    document.getElementById('speedControl').addEventListener('input', function() {
        const newSpeed = parseFloat(this.value);
        images.forEach(img => {
            img.style.transitionDuration = `${newSpeed}s`;
        });
    });
    
    document.getElementById('sizeControl').addEventListener('input', function() {
        images.forEach(img => {
            adjustImageSizeAndPosition(img, true);
        });
    });
    
    function adjustImageSizeAndPosition(img, sizeOnly = false) {
        const sizePercentage = document.getElementById('sizeControl').value;
        img.style.width = `${sizePercentage}%`;
        if (!sizeOnly) {
            const offsetX = (Math.random() * 15 + 5) * (images.length % 2 === 0 ? -1 : 1);
            const offsetY = (Math.random() * 15 + 5) * (images.length % 2 === 0 ? -1 : 1);
            img.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
        }
    }
    
    
    document.getElementById('summonButton').addEventListener('click', function() {
        if (imageSrc) {
            const img = document.createElement('img');
            img.src = imageSrc;
            img.classList.add('movableImage');
            document.body.appendChild(img);
            images.push(img);
            adjustImageSizeAndPosition(img);
        }
    });
    
    document.getElementById('resetButton').addEventListener('click', function() {
        images.forEach(img => img.remove());
        images = [];
    });
    
    document.getElementById('speedControl').addEventListener('input', function() {
        const newSpeed = parseFloat(this.value);
        images.forEach(img => {
            img.style.transitionDuration = `${newSpeed}s`;
        });
    });
    
    document.getElementById('sizeControl').addEventListener('input', function() {
        images.forEach(img => {
            adjustImageSizeAndPosition(img, true);
        });
    });
    
    function adjustImageSizeAndPosition(img, sizeOnly = false) {
        const sizePercentage = document.getElementById('sizeControl').value;
        img.style.width = `${sizePercentage}%`;
        if (!sizeOnly) {
            const offsetX = (Math.random() * 15 + 5) * (images.length % 2 === 0 ? -1 : 1);
            const offsetY = (Math.random() * 15 + 5) * (images.length % 2 === 0 ? -1 : 1);
            img.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
        }
    }
    
</script>

</body>
</html>
